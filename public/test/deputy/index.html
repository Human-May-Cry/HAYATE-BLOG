  <!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Take control of your commands with Deputy &middot; ハヤテ </title>
    
    <link rel="stylesheet" type="text/css" href="http://localhost:1313//css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313//css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="http://localhost:1313//img/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="ハヤテ" />
    
    <script src="http://localhost:1313//js/jquery.min.js"></script>
    <script src="http://localhost:1313//js/main.min.js">
    </script>
</head>

  <body>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-bars btn-mobile-menu__icon"></i>
        <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>

<header class="panel-cover panel-cover--collapsed"  style="background-image: url(/img/fender1.jpg)"  id="scriptHeader">
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://localhost:1313//" title="link to homepage for ハヤテ"> <img src="/img/my_picture.jpeg" width="80" alt="ハヤテ logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://localhost:1313//"  title="link to homepage for ハヤテ">ハヤテ</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description"> Personal Blog </p>
                <hr class="panel-cover__divider panel-cover__divider--secondary" />
                <div class="navigation-wrapper">
                    <nav class="cover-navigation cover-navigation--primary">
                        <ul class="navigation">
                            <li class="navigation__item"><a href="http://localhost:1313//#blog" title="link to ハヤテ blog" class="blog-button">Blog</a> </li>
                            </br>  </ul>
                    </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation">    </br>    </ul>
</nav>
 </div>
            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
<noscript>
    <style>
        #scriptHeader {display:none;}
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/img/fender1.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://localhost:1313//" title="link to homepage for ハヤテ"> <img src="/img/my_picture.jpeg" width="80" alt="ハヤテ logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://localhost:1313//"  title="link to homepage for ハヤテ">ハヤテ</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  This site is built using <a href="http://gohugo.io">hugo</a> and the theme is built by <a href="http://fredrikloch.me">Fredrik</a> if you enjoy it, it is available at <a href="https://github.com/SenjinDarashiva/hugo-uno">github</a>  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                                <li class="navigation__item"><a href="http://localhost:1313//#blog" title="link to ハヤテ blog" class="blog-button">Blog</a> </li>
                                </br>  </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation">    </br>    </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <div class="post">
          <h1>Take control of your commands with Deputy</h1>
          <span class="post-date">Tue, Jun 30, 2015</span>
          

<p><img src="https://cloud.githubusercontent.com/assets/3185864/8237448/6bc30102-15bd-11e5-9e87-6423197a73d6.jpg" alt="deputy-sm" />
</p>

<p><sup><sub>image: creative commons, &copy; <a href="http://matsurd.deviantart.com/art/Paper53-Deputy-Stubbs-342123485">MatsuRD</a></sub></sup></p>

<p>As a part of my work on <a href="https://github.com/juju/juju">Juju</a>, I have published a
new package at <a href="http://github.com/juju/deputy">http://github.com/juju/deputy</a>.  I think it&rsquo;ll be of general use
to a lot of people.</p>

<script src="http://source.pixiv.net/source/embed.js" data-id="48396407_8e7ae23ffe49c53554a5d4ca859b1d63" data-size="medium" data-border="off" charset="utf-8"></script><noscript><p><a href="http://www.pixiv.net/member_illust.php?mode=medium&amp;illust_id=48396407" target="_blank">鳴狐</a> by <a href="http://www.pixiv.net/member.php?id=919490" target="_blank">コクル</a> on <a href="http://www.pixiv.net/" target="_blank">pixiv</a></p></noscript>

<blockquote class="twitter-tweet" lang="zh-tw"><p lang="ja" dir="ltr">スマホRPGは今これをやってるよ。今のジョブはこれ！&#10;<a href="http://t.co/8i9OuYcCKl">pic.twitter.com/8i9OuYcCKl</a> ゲーム内プロフィール→ <a href="http://t.co/A2f9BADYQU">http://t.co/A2f9BADYQU</a></p>&mdash; HAYATE (@Human_May_Cry) <a href="https://twitter.com/Human_May_Cry/status/620590220711301120">2015 7月 13日</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>

<p><blockquote class="twitter-tweet" lang="zh-tw"><p lang="ja" dir="ltr">【グランブルーファンタジー】ブログ更新しました　⇒　「夏のお便り」　<a href="http://t.co/Ua75N93EyL">http://t.co/Ua75N93EyL</a> <a href="https://twitter.com/hashtag/%E3%82%B0%E3%83%A9%E3%83%96%E3%83%AB?src=hash">#グラブル</a> <a href="http://t.co/6bE2ObJmVP">pic.twitter.com/6bE2ObJmVP</a></p>&mdash; 春田康一@グラブル (@HarutaKoichi) <a href="https://twitter.com/HarutaKoichi/status/620457955368964096">2015 7月 13日</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p><blockquote class="twitter-tweet" lang="en"><p lang="en" dir="ltr">I want to name a package &quot;lieutenant&quot;, but it&#39;s too hard to spell.</p>&mdash; Nate Finch (@NateTheFinch) <a href="https://twitter.com/NateTheFinch/status/610481962311131136">June 15, 2015</a></blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>

<p>True story.  The idea was this package would be a lieutenant commander (get
it?)&hellip; but I also knew I didn&rsquo;t want to have to try to spell lieutenant
correctly every time I used the package.  So that&rsquo;s why it&rsquo;s called deputy.
He&rsquo;s the guy who&rsquo;s not in charge, but does all the work.</p>

<h3 id="errors:c6ab1c3501e7e929f514472ad514e06f">Errors</h3>

<p>At <a href="https://github.com/juju/juju">Juju</a>, we run a lot of external processes
using os/exec. However, the default functionality of an exec.Cmd object is kind
of lacking. The most obvious one is those error returns &ldquo;exit status 1&rdquo;.
Fantastic.  Have you ever wished you could just have the stderr from the command
as the error text?  Well, now you can, with deputy.</p>

<pre><code>func main() {
    d := deputy.Deputy{
        Errors:    deputy.FromStderr,
    }
    cmd := exec.Command(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)
    err := d.Run(cmd)
}
</code></pre>

<p>In the above code, if the command run by Deputy exits with a non-zero exit
status, deputy will capture the text output to stderr and convert that into the
error text.  <em>e.g.</em> if the command returned exit status 1 and output &ldquo;Error: No
such image or container: bar&rdquo; to stderr, then the error&rsquo;s Error() text would
look like &ldquo;exit status 1: Error: No such image or container: bar&rdquo;.  Bam, the
errors from commands you run are infinitely more useful.</p>

<h3 id="logging:c6ab1c3501e7e929f514472ad514e06f">Logging</h3>

<p>Another idiom we use is to pipe some of the output from a command to our logs. This can be super useful for debugging purposes.  With deputy, this is again easy:</p>

<pre><code>func main() {
    d := deputy.Deputy{
        Errors:    deputy.FromStderr,
        StdoutLog: func(b []byte) { log.Print(string(b)) },
    }
    cmd := exec.Command(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)
    err := d.Run(cmd)
}
</code></pre>

<p>That&rsquo;s it.  Now every line written to stdout by the process will be piped as a
log message to your log.</p>

<h3 id="timeouts:c6ab1c3501e7e929f514472ad514e06f">Timeouts</h3>

<p>Finally, an idiom we don&rsquo;t use often enough, but should, is to add a timeout to
command execution.  What happens if you run a command as part of your pipeline
and that command hangs for 30 seconds, or 30 minutes, or forever?  Do you just
assume it&rsquo;ll always finish in a reasonable time?  Adding a timeout to running
commands requires some tricky coding with goroutines, channels, selects, and
killing the process&hellip; and deputy wraps all that up for you in a simple API:</p>

<pre><code>func main() {
    d := deputy.Deputy{
        Errors:    deputy.FromStderr,
        StdoutLog: func(b []byte) { log.Print(string(b)) },
        Timeout:   time.Second * 10,
    }
    cmd := exec.Command(&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;)
    err := d.Run(cmd)
}
</code></pre>

<p>The above code adds a 10 second timeout.  After that time, if the process has
not finished, it will be killed and an error returned.</p>

<p>That&rsquo;s it.  Give deputy a spin and let me know what you think.</p>

        </div>
        

      </div>
    </div>
  </body>
  
</html>
